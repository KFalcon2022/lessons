![](../../commonmedia/header.png)

***

   

DDL. Изменение и удаление таблиц. ALTER. DROP. DEFAULT
======================================================

Мы уже научились создавать таблицы. Но ничто не вечно под луной - даже схема БД, поэтому следующий шаг - знакомство с синтаксисом изменения структуры существующей таблицы и удаления таблицы.

  

### Удаление. Оператор DROP

Удаление элементов БД происходит через оператор **_DROP_**.

Принцип достаточно прост: удаление верхнеуровневого элемента также удалит все вложенные в него. Так, удаление базы данных:

```java
drop database test_db;
```

Удалит саму БД, ее схемы, таблицы и прочие элементы и данные, которые в них хранятся.

Еще один важный момент при удалении таблиц (для нас наиболее актуально) - при удалении таблицы пропадают и связи с этой таблицей, если таковые были. Мы еще не знакомы с синтаксисом обеспечения связей между таблицами на уровне DDL, но, полагаю, это не обязательно, чтобы обратить внимание на этот факт.

Для примера, запрос на удаление таблицы пассажиров:

```java
drop table passenger;
```

Синтаксис удаления очень простой и, при этом, не слишком востребованный на практике (относительно общей массы DDL-запросов), поэтому не вижу особого смысла уделять ему слишком много времени.

  

### Изменение. Оператор ALTER

К сожалению, мы пока не знакомы с рядом важных атрибутов колонок и таблиц, поэтому время от времени придется возвращаться к изученному сегодня синтаксису в разрезе взаимодействия с новыми инструментами. Но есть и хорошая новость: общая структура запроса на изменение таблицы мало отличается от того, что именно мы меняем. Зато именно знакомство с этим синтаксисом позволит нам применять новые изучаемые инструменты на лету, сразу пробуя их на учебной БД и уже существующих в ней таблицах.

Как и _CREATE_ для создания, а _DROP_ \- для удаления, **_ALTER_** \- один из основополагающих и базовых операторов DDL, но для изменения структурного элемента БД.

Таким образом, его можно применить к самой БД, схеме, таблице и т.д. В зависимости от элемента будет зависеть перечень доступных для изменения атрибутов, но общий вид запроса будет примерно одинаковым.

Дальше предлагаю сконцентрироваться на синтаксисе изменения таблицы - наиболее частого применения оператора _ALTER_.

Постараемся разобраться, что из уже знакомых атрибутов БД мы можем менять с помощью _ALTER_ и рассмотрим примеры (на базе несуществующей в тестовой БД таблицы) соответствующих запросов.

  

#### Переименовать таблицу

```java
alter table t rename to t1
```

После _ALTER TABLE_ указано имя таблицы, далее - действие, которое необходимо в таблице выполнить. В данном случае - переименование через оператор _RENAME TO_ с указанием нового имени таблицы.

К слову, таким же образом можно переименовывать схемы и даже саму БД - только table необходимо заменить на schema и database соответственно;

  

#### Перенести таблицу в другую схему

```java
alter table t set schema tt;
```

Как вы можете заметить уже сейчас, часть _ALTER TABLE table\_name_ является общей, дальнейшие операторы зависят от конкретного действия, применяемого к таблице. Заучивать синтаксис всех возможных действий нет необходимости - главное, помнить, какие взаимодействия доступны, остальное вторично.

> Помните, что при обращении к таблице, которая лежит вне схемы **_public_**, название схемы надо указывать явно. Например:  
> **select \* from tt.t;**

  

#### Добавить колонку

```java
alter table t add column col1 int;
```

В данном случае после оператора _ADD_ идет модификатор _COLUMN_, указывающий на добавляемый элемент (добавлять в таблицу можно не только колонку, но, например, и constraint’ы, с которыми мы скоро познакомимся, и ряд иных элементов).

После названия колонки указывается ее тип. Далее могут быть указаны иные атрибуты. Из уже знакомых нам - значение по умолчанию:

```java
alter table t add column col2 timestamp default now();
```

  

#### Удалить колонку

```java
alter table t drop column col1;
```

Тут использован уже знакомый нам оператор _DROP_. Также, как и в случае с _ADD_, применяться он может и к другим элементам таблицы - не только к колонкам.

  

#### Переименовать колонку

```java
alter table t rename column col2 to col1;
```

Тут, полагаю, пояснения избыточны. Объединение общего синтаксиса изменения таблицы и переименования (рассмотренного выше на примере самой таблицы) по отношению к конкретной колонке.

  

#### Добавить колонке значение по умолчанию

```java
alter table t alter column col1 set default 1;
```

> Если применяете запросы из примеров в своей БД - не забудьте снова добавить колонку **col1**, мы ее удалили пару запросов назад:)

функциональность _ALTER COLUMN_, в целом, достаточно широкая - мы разберем еще пару примеров ниже, но это далеко не все возможности данного синтаксиса.

  

#### Удалить у колонки значение по умолчанию

```java
alter table t alter column col1 drop default;
```

Как вы можете заметить, большинство действий происходит вокруг одних и тех же ключевых операторов - меняется лишь контекст их использования.

  

#### Изменить тип колонки

```java
alter table t alter column col1 type date using col1::date;
```

Достаточно сложная конструкция. Как синтаксически, так и в плане применения - необходимо обращаться к касту данных или иному их преобразованию, учитывать нестандартные случаи (если само преобразование не тривиальное) и пр. Благо, менять тип колонок приходится не так часто. И не всегда посредством прямого их изменения.

Синтаксис выше можно описать как:

*   **_alter column col1_** - изменить колонку \[название\];
*   **_type date_** - установить тип \[название\];
*   **_using_** \- используя выражение;
*   **_col1::date_** - \[выражение, позволяющая получить из исходного значения соответствующее значение нужного типа\].

  

Это, вероятно, все преобразования таблицы, доступные для уже известных нам атрибутов. Добавлю лишь один небольшой момент.

Если требуется в рамках одного запроса внести в таблицу несколько изменений - это тоже несложно, обычно достаточно перечислить их через запятую:

```java
alter table t
  add column col3 int,
  drop column col2;
```

К сожалению, у нескольких изменений в рамках одного запроса есть ограничения - скажем, не получится в рамках одного запроса переименовать одну колонку и добавить другую. Однако на практике это редко доставляет неудобства и акцентировать особое внимание на том, какие изменения можно объединять в один запрос, а какие - нет, я не вижу особого смысла.

  

На сегодня все!

Я не вижу особого смысла давать практику по этой теме - сами базовые операции в DDL просты и даются проще, чем DML, при этом на данном этапе нам особо нечего менять в тестовой БД, чтобы это было действительно полезно в дальнейшем (как в случае с созданием новых таблиц).

Поэтому в практике с _ALTER_ мы встретимся в дальнейших уроках, когда изменения существующей структуры таблиц потребуется (а оно потребуется).

Пока же можете придумать и реализовать запросы на свой вкус.

![](../../commonmedia/footer.png)

Если что-то непонятно или не получается – welcome в комменты к посту или в лс:)

Канал: [https://t.me/ViamSupervadetVadens](https://t.me/ViamSupervadetVadens)

Мой тг: [https://t.me/ironicMotherfucker](https://t.me/ironicMotherfucker)

_Дорогу осилит идущий!_