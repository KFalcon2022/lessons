# JSON

Данная статья вытекает из необходимости рассказать об основных способах передачи данных в HTTP. В ней мы познакомимся в
новым способом представления объектов в текстовом виде.

## Введение

Как мы уже знаем, при работе с HTTP основная полезная нагрузка передается в теле запроса или в теле ответа - в
зависимости от того, передаются данные от клиента серверу или наоборот.

Логично, что разные виды данных передаются в разных форматах. Так, обычный текст можно передать простой строкой - это
уже было продемонстрировано при знакомстве с сервлетами. В случае с HTML-документами формат передачи тоже очевиден -
HTML. Также есть возможность передачи файлов, бинарной информации (читай, массива байт) неизвестного содержания и
практически любой иной информации. Однако в разрезе текущей статьи нас это мало интересует.

Чаще всего разработчику приходится сталкиваться с необходимостью передавать данные, структура которых заранее
известна, но значения в рамках этой структуры формируются в ходе обработки запроса. Иными словами - передавать
репрезентацию объектов (в Java-приложениях - Java-объектов) в текстовом виде.

Таким образом необходим не привязанный к конкретному языку программирования контракт (формат данных), который
позволил бы передавать объекты между клиентом и сервером. При этом данный формат должен быть понятен как клиенту,
так и серверу, независимо от языков и технологий, на которых написано клиентское и серверное приложение.

Если мы говорим о коммуникации по Сети (не ограничиваясь HTTP), наиболее популярны следующие два формата:

- XML. С ним мы уже познакомились, изучая Maven. В современном подходе к коммуникации по HTTP он откровенно
  непопулярен, но вероятность встретить XML в старых приложениях существует. Кроме того, существуют протоколы
  (например, [SOAP](https://ru.wikipedia.org/wiki/SOAP)), для которых передача объектов в виде XML является основным
  или единственным возможным подходом;
- JSON (_JavaScript Object Notation_). Этот формат предлагает более лаконичную форму записи, нежели XML, в силу чего
  является как более читабельным для человека, так и более дешевым - ведь чем меньше символов нужно для описания, тем
  меньше данных нужно физически передавать по сети.

> Несмотря на JavaScript в названии, JSON не имеет какой-либо технической привязки к конкретному языку
> программирования.
>
> Название связано лишь с тем, что сам формат появился в данном языке. Благодаря этому в самом
> JS есть нативная поддержка JSON в синтаксисе самого языка, но это никак не ограничивает использования формата в
> Java или где-либо еще. Как и не требует знания JS для использования JSON.

Внутренней структуре JSON и деталям использования посвящены следующие пункты статьи, пока же познакомимся с несколькими
терминами:

**Сериализация** - процесс преобразования структуры данных (объекта) в вид, пригодный для сохранения или передачи.
Сериализовать объект можно в различные форматы - от массива байт до текстового представления. Сегодня мы будем
использовать этот термин преимущественно в контексте сериализации в JSON.

**Десериализация** - обратный сериализации процесс, преобразование данных из формата хранения/передачи в объект или
иной вид, понятный языку программирования, который будет работать с этими данными.

## Структура и устройство JSON

На самом деле мы уже сталкивались с JSON - в практике к
[статье](https://github.com/KFalcon2022/lessons/blob/master/lessons/web-and-java-ee/139/HTTP%20clients.md),
посвященной HTTP-клиентам. Именно в виде JSON там передаются тела запросов и ответов. Благодаря этому можно оценить
внешний вид JSON-документов.

Наиболее корректным источником данных об устройстве JSON можно считать следующий RFC:
[ссылка](https://datatracker.ietf.org/doc/html/rfc8259). На случай, если захочется изучить оригинал документации.

Также можно изучить данную страницу: [json.org](https://www.json.org/). Там есть и подробное описание устройства, и
ссылки на обучающие материалы, и ссылки на библиотеки для работы с JSON различных языках программирование. Что
особенно приятно - там есть русская локализация:)

Перейдем непосредственно к структуре. Обычно JSON-документ представляет собой объект, описание которого
располагается внутри `{}`. Либо массив объектов, расположенный внутри `[]`. Поскольку JSON предназначен для описания, в
том числе, иерархических структур данных, внутри основного объекта могут содержаться вложенные - их также можно
определить по использованию фигурных скобок.

Таким образом, пустой JSON-объект выглядит так:

```json
{}
```

Внутри документа могут располагаться его атрибуты (поля), в формате ключ-значение. Имя ключа всегда указывается в
двойных кавычках, ключ от значения отделяется двоеточием. Поля объекта разделяются запятыми:

```json
{
  "string Field": "String\n value",
  "booleanField": true,
  "numberField1": 10,
  "numberField2": 10.303,
  "numberField3": 1.3e3,
  "nullField": null,
  "objectField": {
    "nestedObjectFieldWithEscapedCharacters": "Экранированный слеш: \\. Двойная кавычка: \""
  },
  "arrayField": [
    1,
    [
      2,
      3
    ],
    "string"
  ]
}
```

> **!NB**: в целях лучшей читабельности обычно JSON форматируют, перенося каждое поле на новую строку и разделяя
> ключ и значение пробелом (вдобавок к двоеточию). Также реализуется табуляции, для легкости определения
> вложенных объектов и элементов массивов. Это вы видите в примере выше.
>
> Тем не менее при передаче JSON такая стилизация избыточна (но допустима) и в базовом представлении JSON
> записывается в одну строку и без пробелов (исключая пробелы в строковых значениях).

### Ключи

Ключ в JSON выглядит как строка, обрамленная двойными кавычками. При этом формально ключ может содержать пробелы,
состоять из числа и в целом не имеет жестких ограничений по собственному обозначению.

Но в силу того, что обычно JSON десериализуется в объект того или иного языка программирования, а синтаксис этого языка
программирования обычно имеет ограничения по именованию полей и переменных - как правило, ключи именуются по тем же
правилам, что и поля в языке программирования разработчика, ответственного за формирование JSON.

Благо, в большинстве современных ЯП требования к именам полей и переменных примерно одинаковы и типичное имя ключа
можно ограничить следующими правилами:

1. Поля обозначаются латинскими буквами и цифрами. При этом цифра не может идти первой. Также допустимо
   использование `_`;
2. Если имя ключа состоит из нескольких слов - они разделяются по принципу camelCase или snake_case. При этом в
   некоторых языках принято обозначать поля с большой буквы, поэтому иногда можно встретить нотацию, которая в Java
   привычна для классов - CamelCase.

### Значения и типы данных

На примере выше продемонстрированы существующие в JSON типы данных и некоторые нюансы их использования. Тезисно типы
можно описать так:

1. Строка. Обозначается двойными кавычками, внутри которых могут быть любые символы в кодировке UTF-8*. Таким образом
   при использовании JSON не требуется локализация или кодирование кириллицы. Единственный серьезный нюанс: обязательно
   требуется экранировать обратным слешем символы `\` и `"`. Если требуется описать многострочное значение -
   доступно использование управляющих символов, включая `\n`;
2. Число. Объединяет в себе целые и вещественные числа. Также доступна запись чисел в экспоненциальной форме. Все
   три варианта отображены в примере выше;
3. Литерал. JSON не вводит самостоятельного понятия `null`, как не вводит и логического типа. Вместо этого он
   предоставляет три литерала, семантика которых явно не описана, но в целом очевидна: `null`, `true`, `false`. В
   отличие от строковых значений, они пишутся без кавычек. Также они должны быть использоваться исключительно в
   нижнем регистре;
4. Объект. Как было сказано выше, обозначается фигурными скобками, внутри которых располагаются поля любых типов,
   включая другие объекты;
5. Массив. Обозначается как квадратные скобки, внутри которых располагаются элементы массива. При этом в одном
   массиве могут находиться элементы разных типов, включая объекты и другие массивы. Последнее позволяет описывать
   многомерные массивы при необходимости.

> *UTF-8 - определенная спецификацией кодировка всего JSON-документа. Таким образом, в JSON по умолчанию доступно
> большинство общеупотребимых символов.
>
> Также существует возможность использования символов из UTF-16. В силу редкости данной задачи и чтобы не углубляться в
> особенности указанных кодировок, лишь обозначу, что для обозначения символов из UTF-16 в JSON необходимо
> использовать **суррогатные пары**. Это не является неким обязательным знанием, но возможно данный термин кому-то
> сократит много времени в будущем.

Указанные типы в целом покрывают стандартные типы большинства языков программирования. Но превносят небольшие
проблемы с использованием некоторых других часто используемых, но не базовых типов - например даты и времени. В силу
этого такие типы сериализуют либо в строку, либо в число
([Unix-время](https://ru.wikipedia.org/wiki/Unix-%D0%B2%D1%80%D0%B5%D0%BC%D1%8F)). Последнее хорошо подходит для
даты и времени (`Instant`, `LocalDateTime`, `Date` в Java), но совершенно не подходит для обозначения даты и времени
и временной зоной (`ZonedDateTime`). Кроме того, передача в формате UNIX-времени ухудшает читаемость JSON - ведь
фактическое значение даты интуитивно непонятно. Поэтому чаще используется сериализация в строку в заранее
оговоренном формате на базе [ISO 8601](https://ru.wikipedia.org/wiki/ISO_8601) (по ссылке есть таблица с примерами).

## Использование JSON

JSON является одним из основных способов хранения и передачи данных в современной разработке. Он используется
практически повсюду - от баз данных до
[брокеров сообщений](https://ru.wikipedia.org/wiki/%D0%91%D1%80%D0%BE%D0%BA%D0%B5%D1%80_%D1%81%D0%BE%D0%BE%D0%B1%D1%89%D0%B5%D0%BD%D0%B8%D0%B9).
Так, например, некоторые СУБД предоставляют либо возможность сохранить данные в виде JSON (например, типы колонок
`JSON` и `JSONB` в PostrgeSQL), либо в принципе хранят записи в виде JSON или основанном на нем формате в своей
внутренней структуре (например, MongoDB).

Более того, в некоторых языках программирования и фреймворках даже конфигурация описывается именно в виде
JSON-документ (файл с расширением `.json`), а не более привычных для Java-разработчиков `.xml`, `.properties` и `.yml`.

Популярность JSON можно объяснить несколькими причинами, которые станут очевидны после знакомства с его структурой:

1. Легкость описания иерархических и вложенных структур. Это базис, на котором строятся все подобные форматы,
   включая XML;
2. Лаконичность. Как было сказано выше, JSON-документы банально короче, чем аналогичные им XML-документы. Это
   связано с тем, что JSON не построен на концепции тегов, визуально он напоминает описание полей в классе;
3. Наличие типов данных. Проблема большинства форматов, вроде XML и пока еще незнакомого нам YAML (также проходит
   под кодовым именем `.yml`) в невозможности на уровне файла определить, является ли значением числом, строкой или
   булевым значением. Также в них относительно неочевидный формат записи массивов;
4. Читабельность. По сути, она вытекает из трех предыдущих пунктов. Но именно это в конечном итоге упрощает ручное
   заполнение JSON (например, при тестировании) и визуальное нахождение ошибок или недочетов в документе.

### Особенности использования в HTTP

При передаче тела запроса или ответа необходимо указывать тип данных в теле. Для этого существует
заголовок `Content-Type`. В нем существует три основных атрибута:

1. `media-type`. Необходим для указания типа передаваемой информации. Список значений можно найти здесь: 
   [список MIME-типов](https://ru.wikipedia.org/wiki/%D0%A1%D0%BF%D0%B8%D1%81%D0%BE%D0%BA_MIME-%D1%82%D0%B8%D0%BF%D0%BE%D0%B2). 
   Для HTML корректным значением будет `text/html`, для обычного текста - `text/plain`, для JSON - 
   `application/json`. При этом в некоторых ситуациях одному расширению файла (или формату) может соответствовать 
   несколько MIME-типов - XML, Excel-таблицы, JPEG и ряд других типов;
2. `charset`. Необходим для указания кодировки передаваемых данных. Для JSON - `utf-8`;
3. `boundary`. Необходим для передачи больших объемов данных, обычно файлов. На данном этапе для нас неинтересен.

## Заключение

JSON - достаточно удобный и простой в освоении формат данных, чем и завоевал свою популярность. Но работа с ним в 
Java имеет ряд тонкостей. Чему и будет посвящена следующая статья.

#### На сегодня все!

![img.png](../../../commonmedia/justTheoryFooter.png)

> Если что-то непонятно или не получается – welcome в комменты к посту или в лс:)
>
> Канал: https://t.me/ViamSupervadetVadens
>
> Мой тг: https://t.me/ironicMotherfucker
>
> **Дорогу осилит идущий!**
